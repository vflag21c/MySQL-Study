# 복제
데이터베이스를 사용하고 운영할 때 가장 중요한 두 가지 요소를 꼽으라면 바로 `확장성`과 `가용성`이다.  
이 두 요소를 위해 가장 일반적으로 사용되는 기술이 바로 `복제(Replication)`이다. 

### 복제 타입

#### - 바이너리 로그 파일 위치 기반 복제

#### - 글로벌 트랜잭션 아이디(GTID) 기반 복제
 DBA가 사용하는 대부분의 DB 관리자 계정은 모든 권한이 할당된 경우가 많다. READ_ONLY로 설정돼 있는 복제 환경에서 실수로 관리자 계정을 통해 DDL 이나 DML 를 실행한 경우 레플리카 서버의 GTID에는 소스 서버로부터 넘어오는 GTID 셋과 더불어 
 레플리카 서버의 server_uuid 로 구성된 새로운 GTID 셋이 추가되는데, 이렇게 되면 `소스 서버와 레플리카 서버 간의 GTID 셋이 달라져 나중에 소스 서버와 레플리카 서버의 역할을 스위치할 때 문제가 될 수 있다.`
 
### 복제 동기화 방식

#### 비동기 복제
소스 서버에 커밋된 트랜잭션은 바이너리 로그에 기록되며, 레플리카 서버에서는 주기적으로 신규 트랜잭션에 대한 바이너리 로그를 소스 서버에 요청한다.  
비동기 복제 방식에서 소스 서버는 레플리카 서버로 변경 이벤트가 잘 전달됐는지, 실제로 적용됐는지 알지 못하며 이에 대한 어떠한 보장도 하지 않는다.

#### 반동기 복제
소스 서버는 레플리카 서버가 소스 서버로부터 전달받은 변경 이벤트를 릴레이 로그에 기록 후 응답(ACK)을 보내면 그때 트랜잭션을 완전히 커밋시키고 클라이언트에 결과를 반환한다.

### 복제 토폴로지

#### 싱글 레플리카 복제 구성
가장 기본적인 형태로, 제일 많이 사용되는 형태라고 할 수 있다. 하나의 소스 서버에 하나의 레플리카 서버만 연결돼 있는 복제 형태.

#### 멀티 레플리카 복제 구성
하나의 소스 서버에 2개 이상의 레플리카 서버를 연결한 복제 형태로, 보통 싱글 레플리카 복제 구성에서 추가적인 용도를 위해 여분의 레플리카 서버가 더 필요해졌을 때 자주 사용되는 형태.

#### 체인 복제 구성
멀티 레플리카 복제 구성에서 레플리카 서버가 너무많아 소스 서버의 성능에 악영향이 예상된다면 1:M:M 구조의 체인 복제 구성을 고려해 볼 수 있다.  
이 복제 형태는 MySQL 서버를 업그레이드하거나 장비를 일괄 교체할 때도 많이 사용된다.

#### 듀얼 소스 복제 구성
두 개의 MySQL 서버가 서로 소스 서버이자 레플리카 서버로 구성돼 있는 형태를 말한다.  
듀얼 소스 구성은 두 MySQL 서버 모두 쓰기가 가능하다는 것이 제일 큰 특징이며, 각 서버에서 변경한 데이터는 복제를 통해 다시 각 서버에 적용되므로 양쪽에서 쓰기가 발생하지만 두 서버는 서로 동일한 데이터를 갖게 된다.  

#### 멀티 소스 복제 구성
하나의 레플리카 서버가 둘 이상의 소스 서버를 갖는 형태를 말한다.  

목적
 > - 여러 서버에 존재하는 각기 다른 데이터를 하나의 MySQL 서버로 통합
 > - 여러 서버에 샤딩돼 있는 테이블 데이터를 하나의 테이블로 통합
 > - 여러 서버의 데이터들을 모아 하나의 MySQL 서버에서 백업을 수행
 



