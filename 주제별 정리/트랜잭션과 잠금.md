# 트랜잭션과 잠금

> `잠금`lock 과 `트랜잭션`은 서로 비슷한 개념 같지만 사실 잠금은 동시성을 제어하기 위한 기능이고 트랜잭션은 데이터의 정합성을 보장하기 위한 기능이다.

 - 프로그램의 코드가 데이터베이스 커넥션을 가지고 있는 범위와 트랜잭션이 활성화돼 있는 프로그램의 범위를 최소화 해야 한다.


 - 글로벌 락
 - 테이블 락
   - innoDB 의 경우 `DML` 쿼리에서는 무시되고 스키마를 변경하는 `DDL`의 경우에만 영향을 미친다.
 - 네임드 락
   - 네임드 락의 경우 많은 레코드에 대해서 복잡한 요건으로 레코드를 변경하는 트랜잭션에 유용하게 사용 할 수 있다.
   - ex ) 배치 프로그램의 경우 동일 데이터를 변경하거나 참조하는 프로그램끼리 분류해서 네임드 락을 걸고 쿼리를 실행 하는 방법으로 데드락을 최소화
 - 메타데이터 락
 - 레코드 락
 - 갭 락
   - 갭 락의 역할은 레코드와 레코드 사이의 간격에 새로운 레코드가 INSERT 되는 것을 제어하는 것이다.
 - 넥스트 키 락
 - 자동 증가 락

## `MySQL` 의 격리 수준
격리 수준이 높아질수록 MySQL 서버의 처리 성능이 많이 떨어질 것으로 생각하는데, 사실 `SERIALIZABLE` 격리 수준이 아니라면 크게 성능의 개선이나 저하는 발생하지 않는다.

|                 | DIRTY READ | NON-REPEATABLE READ | PHANTOM READ     |
|-----------------|------------|---------------------|------------------|
| READ UNCOMMITED | 발생         | 발생                  | 발생               |
| READ COMMITED   | 없음         | 발생                  | 발생               |
| REPEATABLE READ | 없음         | 없음                  | 발생(InnoDB 는 없음 ) |
| SERIALIZABLE    | 없음         | 없음                  | 없음               |

> 일반적인 온라인 서비스 용도의 데이터베이스는 `READ COMMITTED`, `REPEATABLE READ` 중 하나를 사용한다.

 - DIRTY READ
   - 어떤 트랜잭션에서 처리한 작업이 완료되지 않았는데도 다른 트랜잭션에서 볼 수 있는 현상을 `DIRTY READ` 라고 한다. MySQL 을 사용한다면 최소한 `READ committed` 이상의 격리수준을 사용할 것을 권장.